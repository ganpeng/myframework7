<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width initial-scale=1.0 user-scalable=no">
    <link rel="stylesheet" type="text/css" href="bower_components/Framework7/dist/css/framework7.material.colors.css">
    <link rel="stylesheet" type="text/css" href="bower_components/Framework7/dist/css/framework7.material.css">
    <title>Document</title>
    <style type="text/css">
    .infinite-scroll-preloader {
        margin-top: -20px;
        margin-bottom: 10px;
        text-align: center;
    }
    
    .infinite-scroll-preloader .preloader {
        width: 34px;
        height: 34px;
    }
    </style>
</head>

<body>
    <!-- Views -->
    <div class="view" data-page="infinite-scroll">
        <!-- Scrollable page content -->
        <div data-page="infinite-scroll" class="page">
            <!--
                <div class="page-content infinite-scroll">
                    <div class="list-block">
                        <ul>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 1</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 2</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 3</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 4</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 5</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 6</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 7</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 8</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 9</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 10</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 11</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 12</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 13</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 14</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 15</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 16</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 17</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 18</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 19</div>
                                </div>
                            </li>
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">Item 20</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="infinite-scroll-preloader">
                        <div class="preloader"></div>
                    </div>
                </div>
                -->
            <div class="page-content pull-to-refresh-content">
                <div class="pull-to-refresh-layer">
                    <div class="preloader"><span class="preloader-inner"><span class="preloader-inner-gap"></span><span class="preloader-inner-left"><span class="preloader-inner-half-circle"></span></span><span class="preloader-inner-right"><span class="preloader-inner-half-circle"></span></span>
                        </span>
                    </div>
                    <div class="pull-to-refresh-arrow"></div>
                </div>
                <div class="list-block media-list">
                    <ul>
                        <li class="item-content">
                            <div class="item-media"><img src="http://hhhhold.com/88/d/jpg?1" width="44"></div>
                            <div class="item-inner">
                                <div class="item-title-row">
                                    <div class="item-title">Yellow Submarine</div>
                                </div>
                                <div class="item-subtitle">Beatles</div>
                            </div>
                        </li>
                        ...
                    </ul>
                    <div class="list-block-label">
                        <p>Just pull page down to let the magic happen.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <script type="text/javascript" src="bower_components/Framework7/dist/js/framework7.min.js"></script> -->
    <!-- <script type="text/javascript" src="bower_components/Framework7/dist/js/framework7.js"></script> -->
    <script type="text/javascript" src="a.js"></script>
    <!-- <script type="text/javascript" src="index.js"></script> -->
    <script type="text/javascript">
    window.onload = function() {
        var myApp = new Framework7();

        var $$ = Dom7;

        // 随意编造的内容
        var songs = ['Yellow Submarine', 'Don\'t Stop Me Now', 'Billie Jean', 'Californication'];
        var authors = ['Beatles', 'Queen', 'Michael Jackson', 'Red Hot Chili Peppers'];

        var page = 1;

        // 下拉刷新页面
        var ptrContent = $$('.pull-to-refresh-content');

        // 添加'refresh'监听器
        ptrContent.on('refresh', function(e) {

            var data = {
                page: page++,
                results: 1,
                seed: 'abc'
            };

            fetchData(data)
                .then(function(res) {
                    return renderData(res);
                })
                .then(function(html) {
                    updateHtml(html);
                })
                .catch(function(err) {
                    console.log(err);
                })

        });

        function fetchData(data) {
            return new Promise(function(resolve, reject) {
                $$.ajax({
                    url: 'http://api.randomuser.me/',
                    dataType: 'json',
                    data: data,
                    success: function(res) {
                        resolve(res);
                    },
                    error: function(err) {
                        reject(err);
                    }
                })
            })
        }

        function renderData(data) {
            return '<li class="item-content">' +
                '<div class="item-media"><img src="' + data.results[0].picture.thumbnail + '" width="44"/></div>' +
                '<div class="item-inner">' +
                '<div class="item-title-row">' +
                '<div class="item-title">' + data.results[0].email + '</div>' +
                '</div>' +
                '<div class="item-subtitle">' + data.results[0].phone + '</div>' +
                '</div>' +
                '</li>';
        }

        function updateHtml(html) {
            ptrContent.find('ul').prepend(html);
            myApp.pullToRefreshDone();
        }
    }
    </script>
</body>

</html>
